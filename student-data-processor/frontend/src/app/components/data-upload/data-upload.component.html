<div class="upload-container">
  <!-- Header Section -->
  <div class="header">
    <h1>📤 Data Upload - Objective C</h1>
    <p>Upload CSV files to database with automatic +5 score adjustment</p>
  <!-- Removed extra closing div to fix template error -->

  <!-- File Upload Section -->
  <div class="upload-section">
    <div
      class="file-drop-zone"
      [class.has-file]="selectedFile"
      (click)="!selectedFile && triggerFileInput()"
      (dragover)="onDragOver($event)"
      (dragleave)="onDragLeave($event)"
      (drop)="onFileDropped($event)">

      <input
        #fileInput
        type="file"
        id="fileInput"
        accept=".csv"
        (change)="onFileSelected($event)"
        style="display: none;">

      <label class="upload-label">
        <div class="upload-icon">💾</div>
        <div class="upload-text">
          <span *ngIf="!selectedFile" class="upload-main">Click to select CSV file</span>
          <span *ngIf="selectedFile" class="upload-main">{{ getFileInfo() }}</span>
          <span class="upload-hint">Supports .csv files (max {{ formatFileSize(maxFileSize) }})</span>
        </div>
      </label>
    </div>

    <div class="file-requirements" *ngIf="!selectedFile">
      <h4>File Requirements:</h4>
      <ul>
        <li>✅ CSV format (.csv)</li>
        <li>✅ Contains student data with columns: StudentId, FirstName, LastName, DOB, Class, Score</li>
        <li>✅ Maximum file size: {{ formatFileSize(maxFileSize) }}</li>
        <li>✅ Processed from Objective B or similar structure</li>
      </ul>
    </div>

    <!-- Action Buttons -->
    <!-- End of file-drop-zone -->
  </div>

  <!-- Action Buttons moved outside drop zone to prevent double dialog -->
  <div class="button-group" *ngIf="selectedFile">
    <!-- Upload Button - Only shown when not uploading -->
    <button
      *ngIf="!isUploading"
      (click)="onUploadFile()"
      [disabled]="!selectedFile"
      class="btn btn-primary">
      Upload to Database (+5 Score Boost)
    </button>

    <!-- Cancel Button - Only shown when uploading -->
    <button
      *ngIf="isUploading"
      (click)="cancelUpload()"
      class="btn btn-danger">
      <span class="cancel-icon">⚠️</span>
      Cancel Upload
    </button>

    <!-- Upload Status - Only shown when uploading -->
    <div *ngIf="isUploading" class="upload-status">
      <span class="spinner"></span>
      <span>Uploading to Database... Partial data will be available for reporting.</span>
    </div>

    <button
      (click)="clearSelection()"
      [disabled]="isUploading"
      class="btn btn-secondary">
      Clear Selection
    </button>
  </div>
  </div>

  <!-- Progress Indicator -->
  <div class="progress-container" *ngIf="uploadProgress > 0 && uploadProgress < 100">
    <div class="progress-bar">
      <div class="progress-fill" [style.width.%]="uploadProgress"></div>
    </div>
    <div class="progress-text">Uploading... {{ uploadProgress }}%</div>
  </div>

  <!-- Error Display -->
  <div class="error-container" *ngIf="errorMessage">
    <h4>❌ Upload Error</h4>
    <p>{{ errorMessage }}</p>
  </div>

  <!-- Success Message Display -->
  <div class="success-container" *ngIf="successMessage">
    <h4>✅ Notice</h4>
    <p>{{ successMessage }}</p>
  </div>

  <!-- Results Display -->
  <div class="results-container" *ngIf="uploadResult">
    <h3>⚡ Upload Successful!</h3>

    <!-- Performance Banner -->
    <div class="performance-banner" [ngClass]="uploadResult.mode === 'ULTRA-FAST' ? 'ultra-fast-mode' : 'optimized-mode'">
      <span class="mode-label">{{ uploadResult.mode }} MODE</span>
      <span class="performance-metric" *ngIf="uploadResult.recordsPerSecond">
        {{ uploadResult.recordsPerSecond }} records/sec
      </span>
    </div>

    <div class="stats-grid">
      <div class="stat-item">
        <div class="stat-value">{{ uploadResult.recordsProcessed }}</div>
        <div class="stat-label">Records Processed</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">{{ uploadResult.recordsStored }}</div>
        <div class="stat-label">Records Stored</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">{{ uploadResult.processingTimeMs }}ms</div>
        <div class="stat-label">Processing Time</div>
      </div>
      <div class="stat-item" *ngIf="uploadResult.recordsPerSecond">
        <div class="stat-value">{{ uploadResult.recordsPerSecond }}</div>
        <div class="stat-label">Records/Second</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">+5</div>
        <div class="stat-label">Score Boost Applied</div>
      </div>
    </div>

    <!-- Verification Message -->
    <div class="verification-section" *ngIf="uploadResult.verificationMessage">
      <h4>🔍 Verification Results</h4>
      <pre class="verification-text">{{ uploadResult.verificationMessage }}</pre>
    </div>
  </div>

  <!-- Workflow Visualization -->
  <div class="workflow-container">
    <h3>Upload Process Flow</h3>
    <div class="workflow-steps">
      <div class="workflow-step">
        <div class="step-icon">📁</div>
        <div class="step-label">Select CSV</div>
      </div>
      <div class="arrow">→</div>
      <div class="workflow-step">
        <div class="step-icon">📤</div>
        <div class="step-label">Upload File</div>
      </div>
      <div class="arrow">→</div>
      <div class="workflow-step">
        <div class="step-icon">⚙️</div>
        <div class="step-label">Score +5</div>
      </div>
      <div class="arrow">→</div>
      <div class="workflow-step">
        <div class="step-icon">💾</div>
        <div class="step-label">Database</div>
      </div>
    </div>
  </div>
</div>
